<!-- ✅ REUSABLE NAVBAR -->
<nav class="bg-white dark:bg-gray-900 shadow-md">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">

    <!-- Logo -->
    <a href="/index.html" class="text-xl font-bold text-blue-700 dark:text-blue-400">
      CCF Sandoval Events
    </a>

    <!-- Desktop Menu -->
    <div id="desktopMenu" class="hidden md:flex items-center space-x-6">

      <!-- ✅ Buttons -->
      <a href="/login.html"
         class="px-4 py-2 border border-blue-600 text-blue-600 rounded hover:bg-blue-600 hover:text-white transition">
        Log In
      </a>

      <a href="/signup.html"
         class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
        Sign Up
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn"
            aria-controls="mobileMenu"
            aria-expanded="false"
            class="md:hidden text-2xl text-gray-700 dark:text-gray-200">
      ☰
    </button>
  </div>

  <!-- ✅ Mobile Dropdown -->
  <div id="mobileMenu"
       class="hidden md:hidden flex flex-col space-y-3 px-4 pb-4 bg-white dark:bg-gray-900">

    <a href="/login.html"
       class="px-4 py-2 border border-blue-600 text-blue-600 rounded hover:bg-blue-600 hover:text-white transition">
      Log In
    </a>

    <a href="/signup.html"
       class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
      Sign Up
    </a>
  </div>
</nav>

<!-- Sidebar Toggle Button (mobile only) -->
<button id="sidebarToggle" class="sidebar-toggle md:hidden text-gray-700 dark:text-gray-200" type="button" aria-label="Open sidebar">☰</button>

<!-- Sidebar and Overlay -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden md:hidden z-20"></div>
<aside id="sidebar" class="w-64 bg-gray-900 text-gray-200 flex flex-col py-6 shadow-lg fixed md:static inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-30 min-h-screen">
  <h2 class="text-lg font-semibold mb-4 px-6">Menu</h2>
  <nav class="mt-2 w-full px-6 space-y-3">
    <a href="#" class="sidebar-link block text-sm py-2 px-3 rounded hover:bg-gray-800 transition">Dashboard</a>
    <a href="#" class="sidebar-link block text-sm py-2 px-3 rounded hover:bg-gray-800 transition">Profile</a>
    <a href="#" class="sidebar-link block text-sm py-2 px-3 rounded hover:bg-gray-800 transition">Create Venue Reservation</a>
  </nav>
</aside>

<script>
  // Defensive initialization: ensure elements exist before attaching handlers
  (function () {
    const mobileBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    if (!mobileBtn || !mobileMenu) {
      // If elements are not present yet, wait a short time and try again.
      // This helps when the component is inserted dynamically.
      let attempts = 0;
      const maxAttempts = 10;
      const retry = setInterval(() => {
        attempts++;
        const btn = document.getElementById("mobileMenuBtn");
        const menu = document.getElementById("mobileMenu");
        if (btn && menu) {
          clearInterval(retry);
          initMobileToggle(btn, menu);
        } else if (attempts >= maxAttempts) {
          clearInterval(retry);
          console.warn("Navbar: mobile toggle elements not found after retries.");
        }
      }, 100);
      return;
    }

    initMobileToggle(mobileBtn, mobileMenu);

    function initMobileToggle(btn, menu) {
      // Ensure initial state matches viewport
      const setInitialNavState = () => {
        if (window.innerWidth >= 768) {
          menu.classList.remove("hidden");
          btn.setAttribute("aria-expanded", "false");
        } else {
          menu.classList.add("hidden");
          btn.setAttribute("aria-expanded", "false");
        }
      };

      setInitialNavState();

      // Toggle handler (works on touch and click)
      btn.addEventListener("click", () => {
        menu.classList.toggle("hidden");
        const expanded = !menu.classList.contains("hidden");
        btn.setAttribute("aria-expanded", String(expanded));
      });

      // Keep state consistent on resize/orientation change
      let resizeTimer;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(setInitialNavState, 120);
      });

      // Make button easier to tap on small screens
      btn.style.zIndex = "50";
      btn.style.width = btn.style.width || "44px";
      btn.style.height = btn.style.height || "44px";
    }
  })();

  (function() {
    document.addEventListener("DOMContentLoaded", function() {
      var sidebar = document.getElementById("sidebar");
      var sidebarOverlay = document.getElementById("sidebarOverlay");
      var sidebarToggleBtn = document.getElementById("sidebarToggle");
      if (sidebarToggleBtn && sidebar && sidebarOverlay) {
        sidebarToggleBtn.addEventListener("click", function() {
          sidebar.classList.toggle("sidebar--open");
          sidebarOverlay.classList.toggle("hidden");
        });
        sidebarOverlay.addEventListener("click", function() {
          sidebar.classList.remove("sidebar--open");
          sidebarOverlay.classList.add("hidden");
        });
      }
    });
  })();
</script>