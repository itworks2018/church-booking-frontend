<!-- ✅ REUSABLE NAVBAR -->
<nav class="bg-white dark:bg-gray-900 shadow-md">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">

    <!-- Logo -->
    <a href="/index.html" class="text-xl font-bold text-blue-700 dark:text-blue-400">
      CCF Sandoval Events
    </a>

    <!-- Desktop Menu -->
    <div id="desktopMenu" class="hidden md:flex items-center space-x-6">

      <!-- ✅ Buttons -->
      <a href="/login.html"
         class="px-4 py-2 border border-blue-600 text-blue-600 rounded hover:bg-blue-600 hover:text-white transition">
        Log In
      </a>

      <a href="/signup.html"
         class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
        Sign Up
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn"
            aria-controls="mobileMenu"
            aria-expanded="false"
            class="md:hidden text-2xl text-gray-700 dark:text-gray-200">
      ☰
    </button>
  </div>

  <!-- ✅ Mobile Dropdown -->
  <div id="mobileMenu"
       class="hidden md:hidden flex flex-col space-y-3 px-4 pb-4 bg-white dark:bg-gray-900">

    <a href="/login.html"
       class="px-4 py-2 border border-blue-600 text-blue-600 rounded hover:bg-blue-600 hover:text-white transition">
      Log In
    </a>

    <a href="/signup.html"
       class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
      Sign Up
    </a>
  </div>
</nav>

<script>
  // Defensive initialization: ensure elements exist before attaching handlers
  (function () {
    const mobileBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    if (!mobileBtn || !mobileMenu) {
      // If elements are not present yet, wait a short time and try again.
      // This helps when the component is inserted dynamically.
      let attempts = 0;
      const maxAttempts = 10;
      const retry = setInterval(() => {
        attempts++;
        const btn = document.getElementById("mobileMenuBtn");
        const menu = document.getElementById("mobileMenu");
        if (btn && menu) {
          clearInterval(retry);
          initMobileToggle(btn, menu);
        } else if (attempts >= maxAttempts) {
          clearInterval(retry);
          console.warn("Navbar: mobile toggle elements not found after retries.");
        }
      }, 100);
      return;
    }

    initMobileToggle(mobileBtn, mobileMenu);

    function initMobileToggle(btn, menu) {
      // Ensure initial state matches viewport
      const setInitialNavState = () => {
        if (window.innerWidth >= 768) {
          menu.classList.remove("hidden");
          btn.setAttribute("aria-expanded", "false");
        } else {
          menu.classList.add("hidden");
          btn.setAttribute("aria-expanded", "false");
        }
      };

      setInitialNavState();

      // Toggle handler (works on touch and click)
      btn.addEventListener("click", () => {
        menu.classList.toggle("hidden");
        const expanded = !menu.classList.contains("hidden");
        btn.setAttribute("aria-expanded", String(expanded));
      });

      // Keep state consistent on resize/orientation change
      let resizeTimer;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(setInitialNavState, 120);
      });

      // Make button easier to tap on small screens
      btn.style.zIndex = "50";
      btn.style.width = btn.style.width || "44px";
      btn.style.height = btn.style.height || "44px";
    }
  })();
</script>