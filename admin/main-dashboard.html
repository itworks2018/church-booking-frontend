<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet" />
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- ✅ Top Navbar -->
  <nav class="bg-white shadow px-6 py-4 flex justify-between items-center border-b">
    <h1 class="text-xl font-bold text-gray-800">Admin Dashboard</h1>
    <div class="flex items-center space-x-4">
      <span class="text-gray-700">Welcome, <span id="adminName">Admin</span></span>
      <!-- Profile Dropdown -->
      <div class="relative z-50">
        <button id="profileBtn" class="w-10 h-10 rounded-full bg-gray-300"></button>
        <div id="profileMenu"
             class="hidden absolute right-0 mt-2 w-40 bg-white shadow-lg rounded p-2 border">
          <button onclick="logout()"
                  class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
            Log Out
          </button>
        </div>
      </div>
    </div>
    <button id="sidebarToggle" class="md:hidden text-gray-700 text-2xl ml-4" type="button" aria-label="Open sidebar">☰</button>
  </nav>

  <!-- Layout wrapper: sidebar + main -->
  <div class="flex flex-1 relative">
    <!-- Sidebar overlay for mobile -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden md:hidden z-20"></div>

    <!-- Sidebar -->
    <aside id="sidebar"
           class="w-64 bg-gray-900 text-gray-200 flex flex-col items-center py-6 shadow-lg fixed md:static inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-30 min-h-screen">
      <h2 class="text-lg font-bold text-white">CCF Sandoval Events</h2>
      <nav class="mt-6 w-full px-6 space-y-3">
        <button onclick="loadPage('dashboard.html')" class="w-full text-left p-2 rounded text-gray-200 hover:bg-gray-800 hover:text-white">Dashboard</button>
        <button onclick="loadPage('manage-events.html')" class="w-full text-left p-2 rounded text-gray-200 hover:bg-gray-800 hover:text-white">Manage Events</button>
        <button onclick="loadPage('profiles.html')" class="w-full text-left p-2 rounded text-gray-200 hover:bg-gray-800 hover:text-white">Profile</button>
        <button onclick="loadPage('resources.html')" class="w-full text-left p-2 rounded text-gray-200 hover:bg-gray-800 hover:text-white">Resources</button>
        <button onclick="loadPage('bookings.html')" class="w-full text-left p-2 rounded text-gray-200 hover:bg-gray-800 hover:text-white">Create Venue Reservation</button>
        <button disabled class="w-full text-left p-2 rounded bg-gray-700 text-gray-500 cursor-not-allowed">More features soon</button>
      </nav>
    </aside>

    <!-- Main content area -->
    <main class="flex-1 p-8 md:ml-0">
      <!-- Content Area -->
      <div id="contentArea" class="bg-white p-6 rounded shadow-lg border text-gray-800 overflow-x-auto">
        <!-- Loaded content appears here -->
      </div>

      <!-- FullCalendar Container -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 w-full mt-8">
        <div id="fullcalendar"></div>
      </div>
    </main>
  </div>

  <script>
    // Sidebar toggle for mobile
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.getElementById("sidebar");
      const sidebarOverlay = document.getElementById("sidebarOverlay");
      const sidebarToggleBtn = document.getElementById("sidebarToggle");
      if (sidebarToggleBtn && sidebar && sidebarOverlay) {
        sidebarToggleBtn.addEventListener("click", function() {
          sidebar.classList.toggle("-translate-x-full");
          sidebarOverlay.classList.toggle("hidden");
        });
        sidebarOverlay.addEventListener("click", function() {
          sidebar.classList.add("-translate-x-full");
          sidebarOverlay.classList.add("hidden");
        });
      }
    });

    // Load a page into #contentArea
    function loadPage(page) {
      fetch(`pages/${page}`)
        .then(res => {
          if (!res.ok) throw new Error("Not found");
          return res.text();
        })
        .then(html => {
          document.getElementById("contentArea").innerHTML = html;
          if (page === "dashboard.html") {
            const oldScript = document.getElementById("adminDashboardScript");
            if (oldScript) oldScript.remove();
            const script = document.createElement("script");
            script.src = "/js/admin-dashboard.js";
            script.id = "adminDashboardScript";
            document.body.appendChild(script);
          }
        })
        .catch(() => {
          document.getElementById("contentArea").innerHTML =
            "<p class='text-red-600 font-semibold'>Page not found.</p>";
        });
    }

    // Profile menu toggle and logout
    document.addEventListener("DOMContentLoaded", () => {
      const profileBtn = document.getElementById("profileBtn");
      if (profileBtn) {
        profileBtn.addEventListener("click", () => {
          document.getElementById("profileMenu").classList.toggle("hidden");
        });
      }
    });

    function logout() {
      localStorage.removeItem("access_token");
      localStorage.removeItem("role");
      localStorage.removeItem("user_role");
      window.location.href = "login.html";
    }

    // Auth check
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("access_token");
      const role = localStorage.getItem("role") || localStorage.getItem("user_role");
      if (!token) {
        window.location.href = "/admin/login.html";
        return;
      }
      if (role !== "admin") {
        window.location.href = "/user/login.html";
        return;
      }
      loadPage("dashboard.html");
    });
  </script>

<script type="module">
  import { Calendar } from "https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.js";
  import { initAdminDashboard } from "/js/admin-dashboard.js";

  document.addEventListener("DOMContentLoaded", () => {
    initAdminDashboard(Calendar);
  });
</script>

  <!-- Footer -->
  <footer class="bg-white shadow-inner py-4 text-center text-sm text-gray-500">
    &copy; 2026 CCF Sandoval Events. All rights reserved.
  </footer>
</body>
</html>