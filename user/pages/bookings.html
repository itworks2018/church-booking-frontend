<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Booking</title>

  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen p-6">

  <div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200">Create a Booking</h2>

    <form id="bookingForm" method="POST" class="space-y-4">

      <!-- ✅ Event Name -->
      <label for="event_name" class="text-gray-700 dark:text-gray-300">Event Name</label>
      <input type="text" id="event_name" name="event_name"
             class="w-full px-4 py-2 rounded border dark:bg-gray-700 dark:text-gray-200"
             placeholder="Enter event name" required />

      <!-- ✅ Venue -->
      <label for="venue_id" class="text-gray-700 dark:text-gray-300">Venue</label>
      <select id="venue_id" name="venue_id"
              class="w-full px-4 py-2 rounded border dark:bg-gray-700 dark:text-gray-200"
              required>
        <option value="">Select Venue</option>
        <option value="1">Main Hall</option>
        <option value="2">Youth Room</option>
        <option value="3">Prayer Room</option>
        <option value="4">Multipurpose Room</option>
      </select>

      <!-- ✅ Start Date/Time -->
      <label for="start_datetime" class="text-gray-700 dark:text-gray-300">Start Date & Time</label>
      <input type="datetime-local" id="start_datetime" name="start_datetime"
             class="w-full px-4 py-2 rounded border dark:bg-gray-700 dark:text-gray-200"
             required />

      <!-- ✅ End Date/Time -->
      <label for="end_datetime" class="text-gray-700 dark:text-gray-300">End Date & Time</label>
      <input type="datetime-local" id="end_datetime" name="end_datetime"
             class="w-full px-4 py-2 rounded border dark:bg-gray-700 dark:text-gray-200"
             required />

      <!-- ✅ Description -->
      <label for="description" class="text-gray-700 dark:text-gray-300">Description</label>
      <textarea id="description" name="description"
                class="w-full px-4 py-2 rounded border dark:bg-gray-700 dark:text-gray-200"
                placeholder="Describe your event (optional)" rows="4"></textarea>

      <!-- ✅ Submit Button -->
      <button type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">
        Submit Booking
      </button>

    </form>
  </div>

  <!-- ✅ BOOKING LOGIC -->
  <script>
    const API_BASE_URL = "https://church-booking-backend.onrender.com";

    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const token = localStorage.getItem("token");
      if (!token) {
        alert("You must be logged in to create a booking.");
        return;
      }

      const event_name = document.getElementById("event_name").value.trim();
      const venue_id = document.getElementById("venue_id").value;
      const start_datetime = document.getElementById("start_datetime").value;
      const end_datetime = document.getElementById("end_datetime").value;
      const description = document.getElementById("description").value.trim();

      // ✅ Client-side validation for date/time logic
      if (new Date(end_datetime) <= new Date(start_datetime)) {
        alert("End date/time must be after start date/time.");
        return;
      }

      try {
        const res = await fetch(`${API_BASE_URL}/api/bookings`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({
            event_name,
            venue_id,
            start_datetime,
            end_datetime,
            description
          })
        });

        const data = await res.json();

        if (!res.ok) {
          alert(data.error || "Booking failed");
          return;
        }

        alert("Booking created successfully!");
        window.location.href = "user-dashboard.html";

      } catch (err) {
        console.error(err);
        alert("Something went wrong. Please try again.");
      }
    });
  </script>

</body>
</html>