<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Log In – Church Booking</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .glass-box {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
  </style>
</head>

<body class="bg-cover bg-center bg-no-repeat min-h-screen flex flex-col"
      style="background-image: url('/assets/images/bg2.jpg');">



  <!-- LOGIN FORM -->
  <div class="flex-grow flex items-center justify-center py-12">
    <div class="glass-box shadow-2xl rounded-2xl p-12 w-full max-w-2xl text-white">
      <h2 class="text-4xl font-extrabold text-center mb-8">Log In</h2>
      <form id="loginForm" class="space-y-8">
        <input type="email" id="email" placeholder="Email"
               autocomplete="email"
               class="w-full px-6 py-4 rounded-lg bg-white/40 text-black placeholder-gray-700 text-lg"
               required />
        <input type="password" id="password" placeholder="Password"
               autocomplete="current-password"
               minlength="6"
               class="w-full px-6 py-4 rounded-lg bg-white/40 text-black placeholder-gray-700 text-lg"
               required />
        <button type="submit"
                class="w-full bg-green-600/90 hover:bg-green-700 text-white py-4 text-xl font-bold rounded-lg shadow-lg transition-all duration-200">
          Log In
        </button>
      </form>
    </div>
  </div>

  <!-- LOGIN LOGIC -->
  <script type="module">
    import { apiRequest, setToken, setRole } from './js/api.js'

    const API_BASE_URL = "https://church-booking-backend.onrender.com";
    const USER_ADMIN_EMAIL = "admin@church.com";

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
  
          method: "POST",
          body: JSON.stringify({ email, password })
        });

        if (!data.token || !data.user?.email) {
          alert("Invalid server response.");
          return;
        }

        // ⭐ ORIGINAL FLOW — but token stored correctly
        setToken(data.token); // stores as access_token

        <!-- LOGIN LOGIC -->
        <script type="module">
          import { apiRequest, setToken, setRole } from './js/api.js';

          const USER_ADMIN_EMAIL = "admin@church.com";

          document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;
            const loginButton = e.target.querySelector('button[type="submit"]');

            // Prevent admin from using user login
            if (email === USER_ADMIN_EMAIL) {
              alert("Admins must use the ADMIN login page.");
              return;
            }

            loginButton.disabled = true;
            loginButton.textContent = "Logging in...";

            try {
              const data = await apiRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
              });

              if (!data.token || !data.user || !data.user.email) {
                alert("Invalid server response.");
                return;
              }

              setToken(data.token); // stores as access_token
              setRole(data.user.role);
              localStorage.setItem("email", data.user.email);
              localStorage.setItem("full_name", data.user.full_name);

              // Redirect to user dashboard
              window.location.href = "user/maindashboard.html";

            } catch (err) {
              console.error(err);
              alert(err.message || "Login failed");
            } finally {
              loginButton.disabled = false;
              loginButton.textContent = "Log In";
            }
          });
        </script>